CREATE TABLE spark_data (
    pdate text,
    relation_name text,
    time_stamp timestamp,
    dataid text,

    orgId text,
    duration float,
    mediaType text,
    call_id text,
    audio_jitter float,
    video_jitter float,
    audio_rtt float,
    video_rtt float,
    audio_packetloss float,
    video_packetloss float,
    uaVersion text,
    uaType text,
    source text,
    audio_is_good int,
    video_is_good int,
    userId text,
    callFailure int,
    legDuration bigint,
    isFile int,
    contentSize bigint,
    isMessage int,
    isCall int,
    isCreate int,
    RTUser text,
    OneToOneUser text,
    GroupUser text,
    TeamUser text,
    OneToOne text,
    Group text,
    Team text,
    deviceId text,
    model text,
    confid text,
    meetingId text,
    callLeg text,
    associated_key text,
    primary key((pdate, relation_name), time_stamp, dataid)
);

CREATE INDEX index_data_time_stamp ON ks_global_pda.spark_data (time_stamp);
CREATE INDEX index_data_org_id ON ks_global_pda.spark_data (orgid);
CREATE INDEX index_data_user_id ON ks_global_pda.spark_data (userid);
CREATE INDEX index_data_relation_name ON ks_global_pda.spark_data (relation_name);

DROP TABLE ks_global_pda.spark_data;
DESCRIBE spark_data;



CREATE TABLE ks_global_pda.spark_agg (
    eventKey text,
    time_stamp timestamp,
    orgId text,
    userId text,
    model text,
    number_of_total_calls bigint,
    number_of_bad_calls bigint,
    number_of_failed_calls bigint,
    number_of_successful_calls bigint,
    number_of_minutes bigint,
    files bigint,
    fileSize bigint,
    registeredEndpointCount bigint,
    createAllNew bigint,
    userCountByOrg bigint,
    allUser bigint,
    oneToOneUser bigint,
    spaceUser bigint,
    teamUser bigint,
    oneToOneCount bigint,
    spaceCount bigint,
    teamCount bigint,
    messages bigint,
    calls bigint,
    period text,
    associated_key text,
    relation_name text,
    primary key(eventKey, time_stamp)

);


CREATE INDEX index_agg_time_stamp ON ks_global_pda.spark_agg (time_stamp);
CREATE INDEX index_agg_org_id ON ks_global_pda.spark_agg (orgid);
CREATE INDEX index_agg_user_id ON ks_global_pda.spark_agg (userid);
CREATE INDEX index_agg_relation_name ON ks_global_pda.spark_agg (relation_name);
CREATE INDEX index_agg_period ON ks_global_pda.spark_agg (period);
CREATE INDEX index_agg_model ON ks_global_pda.spark_agg (model);

DROP TABLE ks_global_pda.spark_agg;
DESCRIBE spark_agg;


CREATE TABLE ks_global_pda.region_ks_mapping (
region text primary key,
ks text
);
DROP TABLE ks_global_pda.region_ks_mapping;
DESCRIBE region_ks_mapping;